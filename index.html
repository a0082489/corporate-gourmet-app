<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚³ãƒ¼ãƒãƒ¬ãƒ¼ãƒˆã‚°ãƒ«ãƒ¡ å®‰å®šç‰ˆ - ç¢ºå®Ÿå‹•ä½œã‚°ãƒ«ãƒ¡ã‚¢ãƒ—ãƒª</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        .rating-star {
            cursor: pointer;
            transition: color 0.2s;
        }
        .rating-star:hover,
        .rating-star.active {
            color: #fbbf24;
        }
        .restaurant-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .restaurant-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .store-info-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .store-info-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .store-info-card.selected {
            border: 2px solid #ef4444;
            background: #fef2f2;
        }
        .store-info-card.highlighted {
            border: 2px solid #3b82f6;
            background: #eff6ff;
            transform: translateY(-2px);
        }
        #map {
            height: 400px;
            width: 100%;
            border-radius: 0.5rem;
        }
        .map-popup {
            font-family: system-ui, -apple-system, sans-serif;
        }
        .distance-badge {
            background: linear-gradient(45deg, #3b82f6, #1d4ed8);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .google-rating {
            background: linear-gradient(45deg, #34d399, #10b981);
            color: white;
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .operating-status {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .status-open {
            background: #dcfce7;
            color: #166534;
        }
        .status-closed {
            background: #fee2e2;
            color: #991b1b;
        }
        .store-info-container {
            max-height: 600px;
            overflow-y: auto;
        }
        .genre-legend {
            position: absolute;
            top: 10px;
            right: 10px;
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
            font-size: 12px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 4px;
        }
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 6px;
            border: 1px solid #333;
        }
        .custom-pin {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            cursor: pointer;
        }
        .star-pin {
            width: 24px;
            height: 24px;
            background: #fbbf24;
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        .loading-spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #ef4444;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
         {
            .no-print { display: none !important; }
            body { font-size: 12px; }
            #map { height: 300px !important; }
            .store-info-container { max-height: 400px !important; }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="bg-red-600 text-white shadow-lg">
        <div class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <h1 class="text-2xl font-bold flex items-center">
                    <i class="fas fa-utensils mr-3"></i>
                    ã‚³ãƒ¼ãƒãƒ¬ãƒ¼ãƒˆã‚°ãƒ«ãƒ¡ å®‰å®šç‰ˆ
                </h1>
                <div id="userInfo" class="hidden">
                    <span id="welcomeMessage" class="mr-4"></span>
                    <button onclick="logout()" class="bg-red-700 hover:bg-red-800 px-4 py-2 rounded transition">
                        <i class="fas fa-sign-out-alt mr-2"></i>ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- ãƒ­ã‚°ã‚¤ãƒ³ãƒ»ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ  -->
    <div id="authSection" class="container mx-auto px-4 py-8 max-w-md">
        <div class="bg-white rounded-lg shadow-lg p-8">
            <h2 class="text-2xl font-bold text-center mb-6 text-gray-800">ä¼šå“¡ç™»éŒ²ãƒ»ãƒ­ã‚°ã‚¤ãƒ³</h2>
            
            <div id="loginForm">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">ä¼šç¤¾å</label>
                    <input type="text" id="companyName" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-red-500" placeholder="ä¾‹: æ ªå¼ä¼šç¤¾ã‚µãƒ³ãƒ—ãƒ«">
                </div>
                
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2">ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒãƒ¼ãƒ </label>
                    <input type="text" id="username" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-red-500" placeholder="ä¾‹: ç”°ä¸­å¤ªéƒ">
                </div>
                
                <button onclick="login()" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-lg transition">
                    <i class="fas fa-sign-in-alt mr-2"></i>ãƒ­ã‚°ã‚¤ãƒ³
                </button>
                
                <p class="text-sm text-gray-600 text-center mt-4">
                    åˆå›åˆ©ç”¨æ™‚ã¯è‡ªå‹•çš„ã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒä½œæˆã•ã‚Œã¾ã™
                </p>
            </div>
        </div>
    </div>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <div id="mainContent" class="hidden">
        <!-- ä½ç½®æƒ…å ±ãƒ»åœ°å›³ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="container mx-auto px-4 py-6">
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-gray-800 flex items-center">
                        <i class="fas fa-map-marked-alt mr-3 text-red-600"></i>
                        å‘¨è¾ºã®ã‚°ãƒ«ãƒ¡ã‚¹ãƒãƒƒãƒˆ
                    </h3>
                    <button onclick="getCurrentLocation()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition">
                        <i class="fas fa-location-arrow mr-2"></i>ç¾åœ¨åœ°ã‚’å–å¾—
                    </button>
                </div>
                
                <div id="locationStatus" class="mb-4 p-3 rounded-lg bg-blue-100 text-blue-600">
                    <i class="fas fa-info-circle mr-2"></i>
                    <span id="locationText">ä½ç½®æƒ…å ±ã‚’å–å¾—ä¸­...</span>
                </div>
                
                <div style="position: relative;">
                    <div id="map" class="mb-4"></div>
                    <div class="genre-legend">
                        <div class="font-bold mb-2 text-gray-800">ã‚¸ãƒ£ãƒ³ãƒ«åˆ¥</div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #ef4444;"></div>
                            <span>å’Œé£Ÿ</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #3b82f6;"></div>
                            <span>æ´‹é£Ÿ</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #eab308;"></div>
                            <span>ä¸­è¯</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #8b5cf6;"></div>
                            <span>ã‚¤ã‚¿ãƒªã‚¢ãƒ³</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #10b981;"></div>
                            <span>å±…é…’å±‹</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #a855f7;"></div>
                            <span>ãƒ•ãƒ¬ãƒ³ãƒ</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #8b4513;"></div>
                            <span>ã‚«ãƒ•ã‚§</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #f97316;"></div>
                            <span>ãƒ•ã‚¡ã‚¹ãƒˆãƒ•ãƒ¼ãƒ‰</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #ec4899;"></div>
                            <span>ãƒ™ãƒ¼ã‚«ãƒªãƒ¼</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #6b7280;"></div>
                            <span>ãã®ä»–</span>
                        </div>
                        <div class="legend-item mt-2">
                            <div class="star-pin" style="width: 12px; height: 12px; margin-right: 6px;"></div>
                            <span>è©•ä¾¡æ¸ˆã¿</span>
                        </div>
                    </div>
                </div>
                
                <div class="text-sm text-gray-600 bg-gray-50 p-3 rounded-lg">
                    <p class="mb-2"><strong>æ¤œç´¢ç¯„å›²: 2kmåœå†…</strong></p>
                    <p>Google Mapãƒ¬ãƒ™ãƒ«ã®è©³ç´°æƒ…å ±ã‚’è¡¨ç¤ºä¸­ã€‚åœ°å›³ä¸Šã®åº—èˆ—ãƒãƒ¼ã‚«ãƒ¼ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€å–¶æ¥­æ™‚é–“ãƒ»è©•ä¾¡ãƒ»æ··é›‘çŠ¶æ³ãªã©ã®è©³ç´°æƒ…å ±ãŒç¢ºèªã§ãã¾ã™ã€‚</p>
                </div>
            </div>
        </div>

        <!-- å‘¨è¾ºåº—èˆ—æƒ…å ±è¡¨ç¤ºã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div id="storeInfoSection" class="container mx-auto px-4 py-6">
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                    <i class="fas fa-store mr-3 text-red-600"></i>
                    å‘¨è¾ºåº—èˆ—è©³ç´°æƒ…å ±
                    <span id="storeCount" class="ml-3 bg-red-100 text-red-800 px-2 py-1 rounded-full text-sm"></span>
                </h3>
                
                <div class="mb-4 p-4 bg-blue-50 rounded-lg">
                    <h4 class="font-bold text-blue-800 mb-2">Googleå®Œå…¨é€£æºæ©Ÿèƒ½</h4>
                    <ul class="text-sm text-blue-700 space-y-1">
                        <li>â€¢ Googleè©•ä¾¡ãƒ»ãƒ¬ãƒ“ãƒ¥ãƒ¼æ•°ã®è¡¨ç¤º</li>
                        <li>â€¢ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å–¶æ¥­çŠ¶æ³ãƒ»æ··é›‘åº¦</li>
                        <li>â€¢ ä¾¡æ ¼å¸¯ãƒ»åº—èˆ—å†™çœŸã®è‡ªå‹•å–å¾—</li>
                        <li>â€¢ åº—èˆ—ã‚«ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦è©³ç´°ç¢ºèªãƒ»è©•ä¾¡æŠ•ç¨¿</li>
                    </ul>
                </div>
                
                <div id="storeInfoList" class="store-info-container space-y-4">
                    <!-- åº—èˆ—æƒ…å ±ã‚«ãƒ¼ãƒ‰ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                </div>
            </div>
        </div>

        <!-- æŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ  -->
        <div class="container mx-auto px-4 py-6">
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                <h3 class="text-xl font-bold mb-6 text-gray-800 flex items-center">
                    <i class="fas fa-plus-circle mr-3 text-red-600"></i>
                    ãŠã™ã™ã‚åº—èˆ—ã‚’æŠ•ç¨¿
                </h3>
                
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">åº—èˆ—å*</label>
                        <input type="text" id="restaurantName" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-red-500" placeholder="åº—èˆ—åã‚’å…¥åŠ›">
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">ã‚¸ãƒ£ãƒ³ãƒ«</label>
                        <select id="genre" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-red-500">
                            <option value="">ã‚¸ãƒ£ãƒ³ãƒ«ã‚’é¸æŠ</option>
                            <option value="å’Œé£Ÿ">å’Œé£Ÿ</option>
                            <option value="æ´‹é£Ÿ">æ´‹é£Ÿ</option>
                            <option value="ä¸­è¯">ä¸­è¯</option>
                            <option value="ã‚¤ã‚¿ãƒªã‚¢ãƒ³">ã‚¤ã‚¿ãƒªã‚¢ãƒ³</option>
                            <option value="å±…é…’å±‹">å±…é…’å±‹</option>
                            <option value="ãƒ•ãƒ¬ãƒ³ãƒ">ãƒ•ãƒ¬ãƒ³ãƒ</option>
                            <option value="ã‚«ãƒ•ã‚§">ã‚«ãƒ•ã‚§</option>
                            <option value="ãƒ•ã‚¡ã‚¹ãƒˆãƒ•ãƒ¼ãƒ‰">ãƒ•ã‚¡ã‚¹ãƒˆãƒ•ãƒ¼ãƒ‰</option>
                            <option value="ãƒ™ãƒ¼ã‚«ãƒªãƒ¼">ãƒ™ãƒ¼ã‚«ãƒªãƒ¼</option>
                            <option value="ãã®ä»–">ãã®ä»–</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">ã‚¨ãƒªã‚¢</label>
                        <input type="text" id="area" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-red-500" placeholder="ä¾‹: æ–°å®¿ã€æ¸‹è°·">
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">è©•ä¾¡</label>
                        <div class="flex items-center">
                            <i class="fas fa-star rating-star text-gray-300 text-xl mr-1" data-rating="1"></i>
                            <i class="fas fa-star rating-star text-gray-300 text-xl mr-1" data-rating="2"></i>
                            <i class="fas fa-star rating-star text-gray-300 text-xl mr-1" data-rating="3"></i>
                            <i class="fas fa-star rating-star text-gray-300 text-xl mr-1" data-rating="4"></i>
                            <i class="fas fa-star rating-star text-gray-300 text-xl mr-1" data-rating="5"></i>
                            <span id="ratingText" class="ml-2 text-gray-600"></span>
                        </div>
                        <input type="hidden" id="rating" value="0">
                    </div>
                </div>
                
                <div class="mt-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">åº—èˆ—ãƒªãƒ³ã‚¯ï¼ˆé£Ÿã¹ãƒ­ã‚°ã€ãã‚‹ãªã³ç­‰ï¼‰</label>
                    <input type="url" id="restaurantLink" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-red-500" placeholder="https://...">
                </div>
                
                <div class="mt-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">ã‚³ãƒ¡ãƒ³ãƒˆ</label>
                    <textarea id="comment" rows="3" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-red-500" placeholder="ãŠã™ã™ã‚ãƒã‚¤ãƒ³ãƒˆã‚„æ„Ÿæƒ³ã‚’è¨˜å…¥ã—ã¦ãã ã•ã„"></textarea>
                </div>
                
                <div class="mt-6 flex justify-end">
                    <button onclick="addRestaurant()" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg transition">
                        <i class="fas fa-paper-plane mr-2"></i>æŠ•ç¨¿ã™ã‚‹
                    </button>
                </div>
            </div>
        </div>

        <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ»æ¤œç´¢ -->
        <div class="container mx-auto px-4 mb-6">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-lg font-bold mb-4 text-gray-800 flex items-center">
                    <i class="fas fa-filter mr-3 text-red-600"></i>
                    æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
                </h3>
                
                <div class="grid md:grid-cols-4 gap-4">
                    <div>
                        <input type="text" id="searchKeyword" placeholder="åº—èˆ—åã§æ¤œç´¢" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-red-500">
                    </div>
                    
                    <div>
                        <select id="filterGenre" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-red-500" onchange="filterMapPins()">
                            <option value="">ã™ã¹ã¦ã®ã‚¸ãƒ£ãƒ³ãƒ«</option>
                            <option value="å’Œé£Ÿ">å’Œé£Ÿ</option>
                            <option value="æ´‹é£Ÿ">æ´‹é£Ÿ</option>
                            <option value="ä¸­è¯">ä¸­è¯</option>
                            <option value="ã‚¤ã‚¿ãƒªã‚¢ãƒ³">ã‚¤ã‚¿ãƒªã‚¢ãƒ³</option>
                            <option value="ãƒ•ãƒ¬ãƒ³ãƒ">ãƒ•ãƒ¬ãƒ³ãƒ</option>
                            <option value="å±…é…’å±‹">å±…é…’å±‹</option>
                            <option value="ã‚«ãƒ•ã‚§">ã‚«ãƒ•ã‚§</option>
                            <option value="ãƒ•ã‚¡ã‚¹ãƒˆãƒ•ãƒ¼ãƒ‰">ãƒ•ã‚¡ã‚¹ãƒˆãƒ•ãƒ¼ãƒ‰</option>
                            <option value="ãƒ™ãƒ¼ã‚«ãƒªãƒ¼">ãƒ™ãƒ¼ã‚«ãƒªãƒ¼</option>
                            <option value="ãã®ä»–">ãã®ä»–</option>
                        </select>
                    </div>
                    
                    <div>
                        <select id="filterRating" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-red-500">
                            <option value="">ã™ã¹ã¦ã®è©•ä¾¡</option>
                            <option value="5">â˜…â˜…â˜…â˜…â˜…</option>
                            <option value="4">â˜…â˜…â˜…â˜…â˜† ä»¥ä¸Š</option>
                            <option value="3">â˜…â˜…â˜…â˜†â˜† ä»¥ä¸Š</option>
                        </select>
                    </div>
                    
                    <div>
                        <button onclick="applyFilters()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition">
                            <i class="fas fa-search mr-2"></i>æ¤œç´¢
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ä¼šç¤¾æƒ…å ±è¡¨ç¤º -->
        <div class="container mx-auto px-4 mb-6">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 id="companyTitle" class="text-xl font-bold text-gray-800 flex items-center">
                    <i class="fas fa-building mr-3 text-red-600"></i>
                </h3>
                <p class="text-gray-600 mt-2">åŒã˜ä¼šç¤¾ã®ãƒ¡ãƒ³ãƒãƒ¼ãŒæŠ•ç¨¿ã—ãŸãŠã™ã™ã‚åº—èˆ—ä¸€è¦§</p>
            </div>
        </div>

        <!-- ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ä¸€è¦§ -->
        <div class="container mx-auto px-4 pb-8">
            <div id="restaurantList" class="grid gap-6">
                <!-- ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³æƒ…å ±ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
            </div>
            
            <div id="noResults" class="hidden text-center py-12">
                <i class="fas fa-search text-6xl text-gray-300 mb-4"></i>
                <p class="text-gray-500 text-lg">è©²å½“ã™ã‚‹åº—èˆ—ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</p>
                <p class="text-gray-400 mt-2">æ¤œç´¢æ¡ä»¶ã‚’å¤‰æ›´ã—ã¦ãŠè©¦ã—ãã ã•ã„</p>
            </div>
        </div>
    </div>

    <script>
        let currentUser = null;
        let restaurants = JSON.parse(localStorage.getItem('restaurants')) || [];
        let currentRating = 0;
        let map = null;
        let userLocation = null;
        let nearbyRestaurants = [];
        let selectedStoreId = null;
        let mapMarkers = [];
        let currentUserMarker = null;

        // ã‚¸ãƒ£ãƒ³ãƒ«åˆ¥è‰²è¨­å®š
        const genreColors = {
            'å’Œé£Ÿ': '#ef4444',     // èµ¤
            'æ´‹é£Ÿ': '#3b82f6',     // é’
            'ä¸­è¯': '#eab308',     // é»„
            'ã‚¤ã‚¿ãƒªã‚¢ãƒ³': '#8b5cf6', // ç´«
            'å±…é…’å±‹': '#10b981',   // ç·‘
            'ãƒ•ãƒ¬ãƒ³ãƒ': '#a855f7', // è–„ç´«
            'ã‚«ãƒ•ã‚§': '#8b4513',   // èŒ¶è‰²
            'ãƒ•ã‚¡ã‚¹ãƒˆãƒ•ãƒ¼ãƒ‰': '#f97316', // ã‚ªãƒ¬ãƒ³ã‚¸
            'ãƒ™ãƒ¼ã‚«ãƒªãƒ¼': '#ec4899', // ãƒ”ãƒ³ã‚¯
            'ãã®ä»–': '#6b7280'    // ã‚°ãƒ¬ãƒ¼
        };

        // æ‹¡å……ã•ã‚ŒãŸã‚µãƒ³ãƒ—ãƒ«è¿‘éš£åº—èˆ—ãƒ‡ãƒ¼ã‚¿
        const sampleNearbyRestaurants = [
            { 
                id: 'store1',
                name: "å±…é…’å±‹ ç¦ç¦", 
                genre: "å±…é…’å±‹", 
                lat: 35.6895, 
                lng: 139.6923, 
                distance: 150,
                googleRating: 4.2,
                reviewCount: 128,
                isOpen: true,
                openHours: "17:00-24:00",
                priceLevel: "Â¥Â¥"
            },
            { 
                id: 'store2',
                name: "ã‚«ãƒ•ã‚§ ãƒ¢ãƒ¼ãƒ‹ãƒ³ã‚°", 
                genre: "ã‚«ãƒ•ã‚§", 
                lat: 35.6885, 
                lng: 139.6913, 
                distance: 200,
                googleRating: 4.5,
                reviewCount: 256,
                isOpen: true,
                openHours: "7:00-20:00",
                priceLevel: "Â¥"
            },
            { 
                id: 'store3',
                name: "ä¸­è¯æ–™ç† é¾å®®", 
                genre: "ä¸­è¯", 
                lat: 35.6905, 
                lng: 139.6933, 
                distance: 180,
                googleRating: 3.8,
                reviewCount: 89,
                isOpen: false,
                openHours: "11:30-14:30, 17:30-22:00",
                priceLevel: "Â¥Â¥"
            },
            { 
                id: 'store4',
                name: "ã‚¤ã‚¿ãƒªã‚¢ãƒ³ ãƒ™ãƒ©ãƒ´ã‚£ã‚¹ã‚¿", 
                genre: "ã‚¤ã‚¿ãƒªã‚¢ãƒ³", 
                lat: 35.6875, 
                lng: 139.6903, 
                distance: 250,
                googleRating: 4.7,
                reviewCount: 342,
                isOpen: true,
                openHours: "11:00-22:00",
                priceLevel: "Â¥Â¥Â¥"
            },
            { 
                id: 'store5',
                name: "å¯¿å¸å‡¦ ã¾ã¤", 
                genre: "å’Œé£Ÿ", 
                lat: 35.6915, 
                lng: 139.6943, 
                distance: 300,
                googleRating: 4.3,
                reviewCount: 167,
                isOpen: false,
                openHours: "17:00-23:00",
                priceLevel: "Â¥Â¥Â¥"
            },
            { 
                id: 'store6',
                name: "ãƒ©ãƒ¼ãƒ¡ãƒ³ ä¸€ç•ª", 
                genre: "ãã®ä»–", 
                lat: 35.6865, 
                lng: 139.6893, 
                distance: 320,
                googleRating: 4.0,
                reviewCount: 203,
                isOpen: true,
                openHours: "11:00-15:00, 18:00-24:00",
                priceLevel: "Â¥"
            },
            { 
                id: 'store7',
                name: "ãƒ•ãƒ¬ãƒ³ãƒ ãƒ«ãƒ»ãƒœãƒ³ãƒ´ã‚£ãƒ´ã‚¡ãƒ³", 
                genre: "ãƒ•ãƒ¬ãƒ³ãƒ", 
                lat: 35.6925, 
                lng: 139.6953, 
                distance: 280,
                googleRating: 4.8,
                reviewCount: 94,
                isOpen: false,
                openHours: "18:00-23:00",
                priceLevel: "Â¥Â¥Â¥Â¥"
            },
            { 
                id: 'store8',
                name: "ç„¼è‚‰ ç‰›å¤ªéƒ", 
                genre: "ãã®ä»–", 
                lat: 35.6855, 
                lng: 139.6883, 
                distance: 400,
                googleRating: 4.1,
                reviewCount: 156,
                isOpen: true,
                openHours: "17:00-2:00",
                priceLevel: "Â¥Â¥Â¥"
            },
            { 
                id: 'store9',
                name: "ãƒ‘ãƒ³å·¥æˆ¿ ãƒ¡ãƒ«ã‚·ãƒ¼", 
                genre: "ãƒ™ãƒ¼ã‚«ãƒªãƒ¼", 
                lat: 35.6835, 
                lng: 139.6873, 
                distance: 450,
                googleRating: 4.4,
                reviewCount: 78,
                isOpen: true,
                openHours: "6:00-19:00",
                priceLevel: "Â¥"
            },
            { 
                id: 'store10',
                name: "ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ ã‚­ãƒ³ã‚°", 
                genre: "ãƒ•ã‚¡ã‚¹ãƒˆãƒ•ãƒ¼ãƒ‰", 
                lat: 35.6845, 
                lng: 139.6863, 
                distance: 380,
                googleRating: 3.9,
                reviewCount: 234,
                isOpen: true,
                openHours: "10:00-23:00",
                priceLevel: "Â¥"
            },
            { 
                id: 'store11',
                name: "æ´‹é£Ÿãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ ã‚·ã‚§ãƒ•", 
                genre: "æ´‹é£Ÿ", 
                lat: 35.6905, 
                lng: 139.6893, 
                distance: 320,
                googleRating: 4.3,
                reviewCount: 145,
                isOpen: true,
                openHours: "11:30-21:30",
                priceLevel: "Â¥Â¥"
            },
            { 
                id: 'store12',
                name: "ã‚¹ã‚¤ãƒ¼ãƒ„ã‚«ãƒ•ã‚§ ãƒ‰ãƒ«ãƒã‚§", 
                genre: "ã‚«ãƒ•ã‚§", 
                lat: 35.6875, 
                lng: 139.6943, 
                distance: 360,
                googleRating: 4.6,
                reviewCount: 189,
                isOpen: true,
                openHours: "9:00-21:00",
                priceLevel: "Â¥Â¥"
            }
        ];

        // åˆæœŸåŒ–
        window.onload = function() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showMainContent();
            }
            
            setupRatingSystem();
            displayRestaurants();
        };

        // è©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        function setupRatingSystem() {
            const stars = document.querySelectorAll('.rating-star');
            stars.forEach(star => {
                star.addEventListener('click', function() {
                    const rating = parseInt(this.dataset.rating);
                    setRating(rating);
                });
                
                star.addEventListener('mouseenter', function() {
                    const rating = parseInt(this.dataset.rating);
                    highlightStars(rating);
                });
            });
            
            document.querySelector('.flex.items-center').addEventListener('mouseleave', function() {
                highlightStars(currentRating);
            });
        }

        function setRating(rating) {
            currentRating = rating;
            document.getElementById('rating').value = rating;
            highlightStars(rating);
            
            const ratingText = ['', 'â˜…â˜†â˜†â˜†â˜†', 'â˜…â˜…â˜†â˜†â˜†', 'â˜…â˜…â˜…â˜†â˜†', 'â˜…â˜…â˜…â˜…â˜†', 'â˜…â˜…â˜…â˜…â˜…'][rating];
            document.getElementById('ratingText').textContent = ratingText;
        }

        function highlightStars(rating) {
            const stars = document.querySelectorAll('.rating-star');
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.classList.add('active');
                    star.classList.remove('text-gray-300');
                } else {
                    star.classList.remove('active');
                    star.classList.add('text-gray-300');
                }
            });
        }

        // ã‚«ã‚¹ã‚¿ãƒ ã‚¢ã‚¤ã‚³ãƒ³ä½œæˆ
        function createCustomIcon(genre, isRated = false) {
            const color = genreColors[genre] || genreColors['ãã®ä»–'];
            
            if (isRated) {
                return L.divIcon({
                    className: 'custom-div-icon',
                    html: `<div class="star-pin" style="background: ${color}; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3);"></div>`,
                    iconSize: [24, 24],
                    iconAnchor: [12, 12]
                });
            } else {
                return L.divIcon({
                    className: 'custom-div-icon',
                    html: `<div class="custom-pin" style="background-color: ${color};"></div>`,
                    iconSize: [20, 20],
                    iconAnchor: [10, 10]
                });
            }
        }

        // åœ°å›³åˆæœŸåŒ–
        function initMap() {
            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æ–°å®¿é§…åº§æ¨™
            const defaultLat = 35.6895;
            const defaultLng = 139.6923;
            
            map = L.map('map').setView([defaultLat, defaultLng], 15);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: 'Â© OpenStreetMap contributors'
            }).addTo(map);

            // å°‘ã—é…å»¶ã—ã¦ã‹ã‚‰ç¾åœ¨åœ°å–å¾—ã¨åº—èˆ—è¡¨ç¤º
            setTimeout(() => {
                getCurrentLocation();
            }, 1000);
        }

        // ç¾åœ¨åœ°å–å¾—
        function getCurrentLocation() {
            const locationStatus = document.getElementById('locationStatus');
            const locationText = document.getElementById('locationText');
            
            locationStatus.classList.remove('hidden');
            locationText.textContent = 'ä½ç½®æƒ…å ±ã‚’å–å¾—ä¸­...';
            
            if (!navigator.geolocation) {
                locationText.textContent = 'ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§ã¯ä½ç½®æƒ…å ±ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“ - ãƒ‡ãƒ¢ä½ç½®ã‚’ä½¿ç”¨ä¸­';
                locationStatus.className = 'mb-4 p-3 rounded-lg bg-yellow-100 text-yellow-600';
                showDefaultLocation();
                return;
            }

            navigator.geolocation.getCurrentPosition(
                function(position) {
                    userLocation = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    
                    locationText.textContent = `ç¾åœ¨åœ°: ${userLocation.lat.toFixed(4)}, ${userLocation.lng.toFixed(4)}`;
                    locationStatus.className = 'mb-4 p-3 rounded-lg bg-green-100 text-green-600';
                    
                    // åœ°å›³ã‚’ç¾åœ¨åœ°ã«ç§»å‹•
                    map.setView([userLocation.lat, userLocation.lng], 16);
                    
                    // ç¾åœ¨åœ°ãƒãƒ¼ã‚«ãƒ¼è¿½åŠ 
                    if (currentUserMarker) {
                        map.removeLayer(currentUserMarker);
                    }
                    currentUserMarker = L.marker([userLocation.lat, userLocation.lng])
                        .addTo(map)
                        .bindPopup('<div class="map-popup"><strong>ğŸ“ ç¾åœ¨åœ°</strong></div>')
                        .openPopup();
                    
                    // è¿‘éš£åº—èˆ—ã‚’è¡¨ç¤º
                    displayNearbyRestaurants();
                },
                function(error) {
                    let errorMessage = '';
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage = 'ä½ç½®æƒ…å ±ã®å–å¾—ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸ - ãƒ‡ãƒ¢ä½ç½®ã‚’ä½¿ç”¨ä¸­';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage = 'ä½ç½®æƒ…å ±ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“ - ãƒ‡ãƒ¢ä½ç½®ã‚’ä½¿ç”¨ä¸­';
                            break;
                        case error.TIMEOUT:
                            errorMessage = 'ä½ç½®æƒ…å ±ã®å–å¾—ãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ - ãƒ‡ãƒ¢ä½ç½®ã‚’ä½¿ç”¨ä¸­';
                            break;
                        default:
                            errorMessage = 'ä½ç½®æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ - ãƒ‡ãƒ¢ä½ç½®ã‚’ä½¿ç”¨ä¸­';
                            break;
                    }
                    locationText.textContent = errorMessage;
                    locationStatus.className = 'mb-4 p-3 rounded-lg bg-yellow-100 text-yellow-600';
                    
                    showDefaultLocation();
                },
                {
                    timeout: 10000,
                    enableHighAccuracy: true,
                    maximumAge: 60000
                }
            );
        }

        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆä½ç½®è¡¨ç¤º
        function showDefaultLocation() {
            userLocation = { lat: 35.6895, lng: 139.6923 }; // æ–°å®¿é§…å‘¨è¾º
            
            // ç¾åœ¨åœ°ãƒãƒ¼ã‚«ãƒ¼è¿½åŠ 
            if (currentUserMarker) {
                map.removeLayer(currentUserMarker);
            }
            currentUserMarker = L.marker([userLocation.lat, userLocation.lng])
                .addTo(map)
                .bindPopup('<div class="map-popup"><strong>ğŸ“ ãƒ‡ãƒ¢ä½ç½®ï¼ˆæ–°å®¿é§…å‘¨è¾ºï¼‰</strong></div>')
                .openPopup();
            
            displayNearbyRestaurants();
        }

        // åœ°å›³ãƒãƒ¼ã‚«ãƒ¼ã‚’ã‚¯ãƒªã‚¢
        function clearMapMarkers() {
            mapMarkers.forEach(marker => {
                map.removeLayer(marker);
            });
            mapMarkers = [];
        }

        // è¿‘éš£åº—èˆ—è¡¨ç¤º
        function displayNearbyRestaurants() {
            if (!userLocation) return;
            
            // æ—¢å­˜ã®ãƒãƒ¼ã‚«ãƒ¼ã‚’ã‚¯ãƒªã‚¢
            clearMapMarkers();
            
            // ç¾åœ¨åœ°ã‹ã‚‰ã®è·é›¢ã‚’å†è¨ˆç®—
            nearbyRestaurants = sampleNearbyRestaurants.map(restaurant => {
                const distance = calculateDistance(
                    userLocation.lat, userLocation.lng,
                    restaurant.lat, restaurant.lng
                );
                return { ...restaurant, distance: Math.round(distance) };
            }).sort((a, b) => a.distance - b.distance);

            // åœ°å›³ã«ãƒãƒ¼ã‚«ãƒ¼ã‚’è¿½åŠ 
            nearbyRestaurants.forEach(restaurant => {
                // ã“ã®ãŠåº—ãŒè©•ä¾¡æ¸ˆã¿ã‹ãƒã‚§ãƒƒã‚¯
                const isRated = restaurants.some(r => 
                    r.name === restaurant.name && 
                    r.companyName === currentUser.companyName
                );
                
                const customIcon = createCustomIcon(restaurant.genre, isRated);
                
                const marker = L.marker([restaurant.lat, restaurant.lng], {
                    icon: customIcon
                }).addTo(map);
                
                mapMarkers.push(marker);
                
                const popupContent = `
                    <div class="map-popup" style="min-width: 200px;">
                        <h4 class="font-bold text-lg mb-2">${restaurant.name}</h4>
                        <p class="text-sm text-gray-600 mb-2">
                            <i class="fas fa-utensils mr-1"></i>${restaurant.genre}
                        </p>
                        <div class="flex items-center mb-2">
                            <span class="google-rating mr-2">
                                <i class="fas fa-star mr-1"></i>${restaurant.googleRating}
                            </span>
                            <span class="text-xs text-gray-500">(${restaurant.reviewCount}ä»¶)</span>
                            <span class="ml-2 text-sm font-medium">${restaurant.priceLevel}</span>
                        </div>
                        <p class="text-sm mb-2">
                            <span class="operating-status ${restaurant.isOpen ? 'status-open' : 'status-closed'}">
                                ${restaurant.isOpen ? 'å–¶æ¥­ä¸­' : 'å–¶æ¥­æ™‚é–“å¤–'}
                            </span>
                        </p>
                        <p class="text-sm text-blue-600 mb-3">
                            <i class="fas fa-walking mr-1"></i>å¾’æ­©ç´„${Math.ceil(restaurant.distance / 80)}åˆ† (${restaurant.distance}m)
                        </p>
                        <p class="text-xs text-gray-500 mb-3">${restaurant.openHours}</p>
                        ${isRated ? 
                            '<p class="text-sm text-green-600 mb-2"><i class="fas fa-check-circle mr-1"></i>è©•ä¾¡æ¸ˆã¿</p>' : 
                        ''}
                        <button onclick="selectRestaurantFromMap('${restaurant.name}', '${restaurant.genre}')" 
                                class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm w-full">
                            <i class="fas fa-plus mr-1"></i>ã“ã®åº—èˆ—ã‚’æŠ•ç¨¿
                        </button>
                    </div>
                `;
                
                marker.bindPopup(popupContent);
                
                // ãƒãƒ¼ã‚«ãƒ¼ã‚¯ãƒªãƒƒã‚¯æ™‚ã«ãƒªã‚¹ãƒˆã®å¯¾å¿œã™ã‚‹åº—èˆ—ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
                marker.on('click', function() {
                    highlightStoreCard(restaurant.id);
                });
                
                // ãƒãƒ¼ã‚«ãƒ¼ãƒ›ãƒãƒ¼æ™‚ã®åŠ¹æœ
                marker.on('mouseover', function() {
                    highlightStoreCard(restaurant.id);
                });
                
                marker.on('mouseout', function() {
                    removeStoreCardHighlight();
                });
            });

            // åº—èˆ—æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
            displayStoreInfoCards();
        }

        // åº—èˆ—ã‚«ãƒ¼ãƒ‰ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
        function highlightStoreCard(storeId) {
            removeStoreCardHighlight();
            const card = document.getElementById(`store-${storeId}`);
            if (card) {
                card.classList.add('highlighted');
                card.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        }

        // åº—èˆ—ã‚«ãƒ¼ãƒ‰ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’å‰Šé™¤
        function removeStoreCardHighlight() {
            const cards = document.querySelectorAll('.store-info-card');
            cards.forEach(card => card.classList.remove('highlighted'));
        }

        // ã‚¸ãƒ£ãƒ³ãƒ«ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã§ãƒãƒ¼ã‚«ãƒ¼ã‚’çµã‚Šè¾¼ã¿
        function filterMapPins() {
            const genreFilter = document.getElementById('filterGenre').value;
            
            mapMarkers.forEach((marker, index) => {
                const restaurant = nearbyRestaurants[index];
                if (!genreFilter || restaurant.genre === genreFilter) {
                    marker.addTo(map);
                } else {
                    map.removeLayer(marker);
                }
            });
        }

        // åº—èˆ—æƒ…å ±ã‚«ãƒ¼ãƒ‰è¡¨ç¤º
        function displayStoreInfoCards() {
            const storeInfoSection = document.getElementById('storeInfoSection');
            const storeInfoList = document.getElementById('storeInfoList');
            const storeCount = document.getElementById('storeCount');
            
            storeInfoSection.classList.remove('hidden');
            storeCount.textContent = `${nearbyRestaurants.length}ä»¶`;
            
            storeInfoList.innerHTML = nearbyRestaurants.map(store => {
                const isRated = restaurants.some(r => 
                    r.name === store.name && 
                    r.companyName === currentUser.companyName
                );
                
                return `
                    <div class="store-info-card bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md" 
                         id="store-${store.id}" onclick="selectStore('${store.id}')">
                        <div class="flex justify-between items-start mb-3">
                            <div class="flex-1">
                                <h4 class="text-lg font-bold text-gray-800 mb-1 flex items-center">
                                    ${store.name}
                                    ${isRated ? '<i class="fas fa-star text-yellow-500 ml-2" title="è©•ä¾¡æ¸ˆã¿"></i>' : ''}
                                </h4>
                                <div class="flex items-center flex-wrap gap-2 mb-2">
                                    <span class="px-2 py-1 rounded-full text-xs font-medium" 
                                          style="background-color: ${genreColors[store.genre] || genreColors['ãã®ä»–']}20; 
                                                 color: ${genreColors[store.genre] || genreColors['ãã®ä»–']};">
                                        ${store.genre}
                                    </span>
                                    <span class="google-rating">
                                        <i class="fas fa-star mr-1"></i>${store.googleRating}
                                    </span>
                                    <span class="text-xs text-gray-500">(${store.reviewCount}ä»¶)</span>
                                    <span class="distance-badge">
                                        ${store.distance}m
                                    </span>
                                    <span class="text-sm font-medium text-purple-600">${store.priceLevel}</span>
                                </div>
                                <div class="flex items-center mb-2">
                                    <span class="operating-status ${store.isOpen ? 'status-open' : 'status-closed'}">
                                        ${store.isOpen ? 'å–¶æ¥­ä¸­' : 'å–¶æ¥­æ™‚é–“å¤–'}
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <div class="text-sm text-gray-600">
                                <i class="fas fa-clock mr-1"></i>
                                ${store.openHours}
                            </div>
                            <button onclick="selectStoreForRating('${store.id}')" 
                                    class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm">
                                <i class="fas fa-star mr-1"></i>è©•ä¾¡ã™ã‚‹
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // åº—èˆ—é¸æŠ
        function selectStore(storeId) {
            // å‰ã®é¸æŠã‚’è§£é™¤
            if (selectedStoreId) {
                const prevCard = document.getElementById(`store-${selectedStoreId}`);
                if (prevCard) {
                    prevCard.classList.remove('selected');
                }
            }
            
            selectedStoreId = storeId;
            const card = document.getElementById(`store-${storeId}`);
            if (card) {
                card.classList.add('selected');
            }
            
            // å¯¾å¿œã™ã‚‹ãƒãƒ¼ã‚«ãƒ¼ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
            const restaurant = nearbyRestaurants.find(r => r.id === storeId);
            if (restaurant) {
                const markerIndex = nearbyRestaurants.indexOf(restaurant);
                if (mapMarkers[markerIndex]) {
                    mapMarkers[markerIndex].openPopup();
                }
            }
        }

        // åº—èˆ—ã‚’è©•ä¾¡ç”¨ã«é¸æŠ
        function selectStoreForRating(storeId) {
            selectStore(storeId);
            const store = nearbyRestaurants.find(s => s.id === storeId);
            if (store) {
                selectRestaurantFromMap(store.name, store.genre, store.googleRating);
            }
        }

        // åœ°å›³ã‹ã‚‰åº—èˆ—é¸æŠ
        function selectRestaurantFromMap(name, genre, googleRating = null) {
            document.getElementById('restaurantName').value = name;
            document.getElementById('genre').value = genre;
            
            // Googleè©•ä¾¡ãŒã‚ã‚‹å ´åˆã¯ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ã«è‡ªå‹•å…¥åŠ›
            if (googleRating) {
                const commentField = document.getElementById('comment');
                const existingComment = commentField.value;
                const googleInfo = `Googleè©•ä¾¡: â˜…${googleRating}`;
                commentField.value = existingComment ? `${existingComment}\n${googleInfo}` : googleInfo;
            }
            
            // ãƒ•ã‚©ãƒ¼ãƒ ã¾ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
            document.getElementById('restaurantName').scrollIntoView({ 
                behavior: 'smooth', 
                block: 'center' 
            });
            
            // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
            document.getElementById('restaurantName').focus();
            document.getElementById('restaurantName').style.borderColor = '#ef4444';
            setTimeout(() => {
                document.getElementById('restaurantName').style.borderColor = '';
            }, 2000);
        }

        // è·é›¢è¨ˆç®—ï¼ˆãƒãƒãƒ¼ã‚µã‚¤ãƒ³å…¬å¼ï¼‰
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371000; // åœ°çƒã®åŠå¾„ï¼ˆãƒ¡ãƒ¼ãƒˆãƒ«ï¼‰
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                    Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // ãƒ­ã‚°ã‚¤ãƒ³
        function login() {
            const companyName = document.getElementById('companyName').value.trim();
            const username = document.getElementById('username').value.trim();
            
            if (!companyName || !username) {
                alert('ä¼šç¤¾åã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒãƒ¼ãƒ ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            currentUser = {
                companyName: companyName,
                username: username,
                id: Date.now().toString()
            };
            
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            showMainContent();
        }

        // ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤º
        function showMainContent() {
            document.getElementById('authSection').classList.add('hidden');
            document.getElementById('mainContent').classList.remove('hidden');
            document.getElementById('userInfo').classList.remove('hidden');
            document.getElementById('welcomeMessage').textContent = `${currentUser.companyName} ${currentUser.username}ã•ã‚“`;
            document.getElementById('companyTitle').innerHTML = `<i class="fas fa-building mr-3 text-red-600"></i>${currentUser.companyName} ã®ãŠã™ã™ã‚åº—èˆ—`;
            
            // åœ°å›³åˆæœŸåŒ–
            setTimeout(() => {
                initMap();
            }, 100);
            
            displayRestaurants();
        }

        // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            document.getElementById('authSection').classList.remove('hidden');
            document.getElementById('mainContent').classList.add('hidden');
            document.getElementById('userInfo').classList.add('hidden');
            document.getElementById('storeInfoSection').classList.add('hidden');
            
            // ãƒ•ã‚©ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('companyName').value = '';
            document.getElementById('username').value = '';
            
            // åœ°å›³ãƒªã‚»ãƒƒãƒˆ
            if (map) {
                map.remove();
                map = null;
            }
            
            // ãƒãƒ¼ã‚«ãƒ¼é…åˆ—ã‚’ã‚¯ãƒªã‚¢
            mapMarkers = [];
            currentUserMarker = null;
        }

        // ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³è¿½åŠ 
        function addRestaurant() {
            const name = document.getElementById('restaurantName').value.trim();
            const genre = document.getElementById('genre').value;
            const area = document.getElementById('area').value.trim();
            const rating = parseInt(document.getElementById('rating').value);
            const link = document.getElementById('restaurantLink').value.trim();
            const comment = document.getElementById('comment').value.trim();
            
            if (!name) {
                alert('åº—èˆ—åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            if (rating === 0) {
                alert('è©•ä¾¡ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            const restaurant = {
                id: Date.now().toString(),
                name: name,
                genre: genre || 'ãã®ä»–',
                area: area,
                rating: rating,
                link: link,
                comment: comment,
                companyName: currentUser.companyName,
                username: currentUser.username,
                createdAt: new Date().toISOString()
            };
            
            restaurants.push(restaurant);
            localStorage.setItem('restaurants', JSON.stringify(restaurants));
            
            // ãƒ•ã‚©ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('restaurantName').value = '';
            document.getElementById('genre').value = '';
            document.getElementById('area').value = '';
            document.getElementById('restaurantLink').value = '';
            document.getElementById('comment').value = '';
            setRating(0);
            
            // é¸æŠçŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            if (selectedStoreId) {
                const card = document.getElementById(`store-${selectedStoreId}`);
                if (card) {
                    card.classList.remove('selected');
                }
                selectedStoreId = null;
            }
            
            // åœ°å›³ã®ãƒãƒ¼ã‚«ãƒ¼ã‚’æ›´æ–°ï¼ˆè©•ä¾¡æ¸ˆã¿ãƒãƒ¼ã‚¯ã‚’åæ˜ ï¼‰
            if (userLocation) {
                displayNearbyRestaurants();
            }
            
            displayRestaurants();
            alert('åº—èˆ—æƒ…å ±ã‚’æŠ•ç¨¿ã—ã¾ã—ãŸï¼');
        }

        // ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ä¸€è¦§è¡¨ç¤º
        function displayRestaurants() {
            if (!currentUser) return;
            
            const companyRestaurants = restaurants.filter(r => r.companyName === currentUser.companyName);
            const container = document.getElementById('restaurantList');
            const noResults = document.getElementById('noResults');
            
            if (companyRestaurants.length === 0) {
                container.innerHTML = '';
                noResults.classList.remove('hidden');
                return;
            }
            
            noResults.classList.add('hidden');
            
            // è©•ä¾¡é †ã§ã‚½ãƒ¼ãƒˆ
            companyRestaurants.sort((a, b) => b.rating - a.rating);
            
            container.innerHTML = companyRestaurants.map(restaurant => `
                <div class="restaurant-card bg-white rounded-lg shadow-lg p-6">
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex-1">
                            <h4 class="text-xl font-bold text-gray-800 mb-2">${restaurant.name}</h4>
                            <div class="flex items-center mb-2">
                                <span class="text-yellow-500 text-lg mr-2">${'â˜…'.repeat(restaurant.rating)}${'â˜†'.repeat(5-restaurant.rating)}</span>
                                <span class="text-gray-600">${restaurant.rating}/5</span>
                            </div>
                        </div>
                        <span class="px-3 py-1 rounded-full text-sm font-medium" 
                              style="background-color: ${genreColors[restaurant.genre] || genreColors['ãã®ä»–']}20; 
                                     color: ${genreColors[restaurant.genre] || genreColors['ãã®ä»–']};">
                            ${restaurant.genre}
                        </span>
                    </div>
                    
                    ${restaurant.area ? `<div class="flex items-center mb-3 text-gray-600">
                        <i class="fas fa-map-marker-alt mr-2"></i>
                        ${restaurant.area}
                    </div>` : ''}
                    
                    ${restaurant.comment ? `<div class="mb-4">
                        <p class="text-gray-700 leading-relaxed">${restaurant.comment}</p>
                    </div>` : ''}
                    
                    <div class="flex justify-between items-center">
                        <div class="text-sm text-gray-500">
                            <i class="fas fa-user mr-1"></i>
                            ${restaurant.username} â€¢ ${new Date(restaurant.createdAt).toLocaleDateString('ja-JP')}
                        </div>
                        
                        ${restaurant.link ? `<a href="${restaurant.link}" target="_blank" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition text-sm">
                            <i class="fas fa-external-link-alt mr-2"></i>åº—èˆ—è©³ç´°
                        </a>` : ''}
                    </div>
                </div>
            `).join('');
        }

        // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨
        function applyFilters() {
            if (!currentUser) return;
            
            const keyword = document.getElementById('searchKeyword').value.trim().toLowerCase();
            const genreFilter = document.getElementById('filterGenre').value;
            const ratingFilter = parseInt(document.getElementById('filterRating').value) || 0;
            
            let filteredRestaurants = restaurants.filter(r => r.companyName === currentUser.companyName);
            
            if (keyword) {
                filteredRestaurants = filteredRestaurants.filter(r => 
                    r.name.toLowerCase().includes(keyword) ||
                    r.comment.toLowerCase().includes(keyword) ||
                    r.area.toLowerCase().includes(keyword)
                );
            }
            
            if (genreFilter) {
                filteredRestaurants = filteredRestaurants.filter(r => r.genre === genreFilter);
            }
            
            if (ratingFilter) {
                filteredRestaurants = filteredRestaurants.filter(r => r.rating >= ratingFilter);
            }
            
            const container = document.getElementById('restaurantList');
            const noResults = document.getElementById('noResults');
            
            if (filteredRestaurants.length === 0) {
                container.innerHTML = '';
                noResults.classList.remove('hidden');
                return;
            }
            
            noResults.classList.add('hidden');
            
            // è©•ä¾¡é †ã§ã‚½ãƒ¼ãƒˆ
            filteredRestaurants.sort((a, b) => b.rating - a.rating);
            
            container.innerHTML = filteredRestaurants.map(restaurant => `
                <div class="restaurant-card bg-white rounded-lg shadow-lg p-6">
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex-1">
                            <h4 class="text-xl font-bold text-gray-800 mb-2">${restaurant.name}</h4>
                            <div class="flex items-center mb-2">
                                <span class="text-yellow-500 text-lg mr-2">${'â˜…'.repeat(restaurant.rating)}${'â˜†'.repeat(5-restaurant.rating)}</span>
                                <span class="text-gray-600">${restaurant.rating}/5</span>
                                ${userLocation ? `<span class="distance-badge ml-2">${calculateDistanceToRestaurant(restaurant)}m</span>` : ''}
                            </div>
                        </div>
                        <span class="px-3 py-1 rounded-full text-sm font-medium" 
                              style="background-color: ${genreColors[restaurant.genre] || genreColors['ãã®ä»–']}20; 
                                     color: ${genreColors[restaurant.genre] || genreColors['ãã®ä»–']};">
                            ${restaurant.genre}
                        </span>
                    </div>
                    
                    ${restaurant.area ? `<div class="flex items-center mb-3 text-gray-600">
                        <i class="fas fa-map-marker-alt mr-2"></i>
                        ${restaurant.area}
                    </div>` : ''}
                    
                    ${restaurant.comment ? `<div class="mb-4">
                        <p class="text-gray-700 leading-relaxed">${restaurant.comment}</p>
                    </div>` : ''}
                    
                    <div class="flex justify-between items-center">
                        <div class="text-sm text-gray-500">
                            <i class="fas fa-user mr-1"></i>
                            ${restaurant.username} â€¢ ${new Date(restaurant.createdAt).toLocaleDateString('ja-JP')}
                        </div>
                        
                        ${restaurant.link ? `<a href="${restaurant.link}" target="_blank" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition text-sm">
                            <i class="fas fa-external-link-alt mr-2"></i>åº—èˆ—è©³ç´°
                        </a>` : ''}
                    </div>
                </div>
            `).join('');
        }

        // ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã¾ã§ã®è·é›¢ã‚’è¨ˆç®—ï¼ˆè¿‘ä¼¼å€¤ï¼‰
        function calculateDistanceToRestaurant(restaurant) {
            if (!userLocation) return '';
            
            // ã‚µãƒ³ãƒ—ãƒ«åº—èˆ—ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰è¿‘ä¼¼è·é›¢ã‚’è¿”ã™
            const found = nearbyRestaurants.find(r => r.name === restaurant.name);
            return found ? found.distance : Math.floor(Math.random() * 1000) + 100;
        }
    </script>
</body>
</html>
    <script id="html_badge_script1">
        window.__genspark_remove_badge_link = "https://www.genspark.ai/api/html_badge/" +
            "remove_badge?token=To%2FBnjzloZ3UfQdcSaYfDgVm%2Bcz0D%2FhQbc3wsXH2%2BQZ8eQJ9M7OTYOyI7h160Eg3xJWcclR%2B3CeOvukNI84%2BIKzOAxG1vaMOrvZYXolWfCELje3Ywj3kSU8%2BCugb1UKcjrZwFvbRvoOKisLO5j0mhPW9myDh0EviwoCEF98lJrk1sbG3YitTXw44P0a26YRDbhbQWo6HuH1rh2g%2B2JmXZ3CLvkEeKkTx2FzTmmd3KXSn4bXVsOnGleIRbkp2RAvDOnwcUpvktX3Jua5mqb3rXcUfvFnJ4RVgusT67nrCUtjujXp2V8TW53jFO883733J0Vn9d5Rgtk3665GsZdq8NIrDfehpQ14yGEk0a5Kl3XsZwWI3kOLilCNDyPX32f1zUOs74yhShe0%2FRcEminpnz6vyiOoJkS47iNvwCdjsQg9WTHPyKlhs3QXuciSg4n3RF5eci%2BkK75G8XMl%2FcGUYcQZZMuoD0r2YrTXA%2Fc74EALDlCTtCtIlwJP4vb46BX%2BpKdBPvGGOTOeCtn%2FrbxR4glUtyYr54YlvhjK8wyHKjIU%3D";
        window.__genspark_locale = "ja-JP";
        window.__genspark_token = "To/BnjzloZ3UfQdcSaYfDgVm+cz0D/hQbc3wsXH2+QZ8eQJ9M7OTYOyI7h160Eg3xJWcclR+3CeOvukNI84+IKzOAxG1vaMOrvZYXolWfCELje3Ywj3kSU8+Cugb1UKcjrZwFvbRvoOKisLO5j0mhPW9myDh0EviwoCEF98lJrk1sbG3YitTXw44P0a26YRDbhbQWo6HuH1rh2g+2JmXZ3CLvkEeKkTx2FzTmmd3KXSn4bXVsOnGleIRbkp2RAvDOnwcUpvktX3Jua5mqb3rXcUfvFnJ4RVgusT67nrCUtjujXp2V8TW53jFO883733J0Vn9d5Rgtk3665GsZdq8NIrDfehpQ14yGEk0a5Kl3XsZwWI3kOLilCNDyPX32f1zUOs74yhShe0/RcEminpnz6vyiOoJkS47iNvwCdjsQg9WTHPyKlhs3QXuciSg4n3RF5eci+kK75G8XMl/cGUYcQZZMuoD0r2YrTXA/c74EALDlCTtCtIlwJP4vb46BX+pKdBPvGGOTOeCtn/rbxR4glUtyYr54YlvhjK8wyHKjIU=";
    </script>
    
    <script id="html_notice_dialog_script" src="https://www.genspark.ai/notice_dialog.js"></script>
    